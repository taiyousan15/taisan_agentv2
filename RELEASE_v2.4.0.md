# TAISUN Agent v2.4.0 リリースノート

**リリース日**: 2026年1月15日
**バージョン**: 2.4.0

---

## 🎉 新機能：ワークフロー Phase 3 - 賢い手順書システム

仕事の流れを自動化する「ワークフロー」がもっと賢くなりました！

### 何ができるようになったの？

#### 1. 📍 **条件分岐** - 状況に応じて次の手順が変わる

**例えば：コンテンツ制作**
```
動画を作る？ 記事を書く？
  ├─ 動画 → 台本作成 → 撮影 → 編集
  └─ 記事 → 構成作成 → 執筆 → 校正
```

**実際の使い方：**
- ファイルの内容で判断（例：`content_type.txt` に「video」か「article」が書いてある）
- ファイルが存在するかで判断（例：設定ファイルがあれば本番モード、なければテストモード）
- 設定値で判断（例：「優先度：高」なら急ぎの手順、「通常」なら標準の手順）

#### 2. ⚡ **並列実行** - 同時に複数の作業をする

**例えば：動画制作**
```
企画が決まったら...
  ├─ 台本を書く（担当：ライター）
  ├─ サムネイルを作る（担当：デザイナー）
  └─ BGMを選ぶ（担当：音響）
     ↓
  全部終わったら編集へ
```

**2つのモード：**
- `全部終わるまで待つ (all)` - 全タスク完了で次へ
- `1つ終わったらOK (any)` - 急ぎの時に便利

#### 3. 🔄 **ロールバック** - やり直しができる

**例えば：デザインレビュー**
```
デザイン → 実装 → レビュー
              ↑
              │ やっぱりデザインから
              │ やり直したい！
              └─ ロールバック
```

**使い道：**
- クライアントの要望変更に対応
- テスト失敗時に前の段階に戻る
- 方針転換が必要になった時

---

## 📚 具体的な使用例

### 例1：動画制作の自動化

```javascript
// ワークフロー設定（簡略版）
{
  "phases": [
    {
      "name": "企画",
      "次の手順": {
        "条件": "content_type.txt の内容",
        "分岐": {
          "動画": "動画制作フェーズ",
          "記事": "記事制作フェーズ"
        }
      }
    },
    {
      "name": "動画制作",
      "並列実行": ["台本", "サムネイル", "BGM"],
      "待ち方": "全部終わるまで"
    }
  ]
}
```

### 例2：優先度別の開発フロー

```javascript
{
  "phases": [
    {
      "name": "優先度判定",
      "条件": "プロジェクトの優先度",
      "分岐": {
        "高": "急ぎコース（並列で開発+QA）",
        "通常": "標準コース（順番に実施）"
      }
    }
  ]
}
```

---

## 🔧 技術的な変更

### Phase 3 機能一覧

| 機能 | 説明 | 用途 |
|------|------|------|
| **条件分岐** | 3つの判定方法 | 動的なワークフロー |
| - file_content | ファイルの中身で判断 | 設定ファイルの内容 |
| - file_exists | ファイルの有無で判断 | 環境判定 |
| - metadata_value | メタデータで判断 | 優先度・カテゴリ |
| **並列実行** | 2つの完了戦略 | 効率化 |
| - waitStrategy: all | 全タスク完了を待つ | 品質重視 |
| - waitStrategy: any | 1つ完了でOK | スピード重視 |
| **ロールバック** | 前の段階に戻る | やり直し対応 |

### テスト品質

- ✅ **50個の自動テスト** - 全て合格
- ✅ **5つのテストカテゴリ**
  - 条件分岐テスト（12個）
  - 並列実行テスト（6個）
  - 統合テスト（6個）
  - ロールバックテスト
  - 型定義テスト

---

## 📖 ドキュメント

新しいドキュメントを追加しました：

- `docs/WORKFLOW_PHASE3_GUIDE.md` - 初心者向けガイド
- `docs/WORKFLOW_PHASE3_DESIGN.md` - 設計仕様書
- `docs/workflows/` - サンプルワークフロー集

---

## 🚀 使い始めるには

### 1. 更新を取得

```bash
git pull origin main
npm install
```

### 2. テストを実行（確認）

```bash
npm test -- --selectProjects=workflow-phase3 --runInBand
```

### 3. サンプルワークフローを試す

```bash
# 動画制作ワークフロー
npm run workflow:start video_generation_v1

# 優先度別開発フロー
npm run workflow:start software_development_v1
```

---

## ⚠️ 重要な注意事項

### テスト実行時

Phase 3 のテストは**必ず `--runInBand` フラグ付き**で実行してください：

```bash
npm test -- --selectProjects=workflow-phase3 --runInBand
```

理由：複数のテストが同時に同じファイルを使うため、順番に実行する必要があります。

---

## 🐛 バグ修正

- ワークフロー定義の読み込みタイミングを修正
- ファイルシステムの競合処理を改善
- 状態管理の安定性向上

---

## 💡 今後の予定

### Phase 4（予定）

- スケジューリング機能（時間指定で自動実行）
- 通知機能（完了時にSlack/Emailで通知）
- ダッシュボード（進捗の可視化）

---

## 🙏 フィードバック

ご意見・ご要望は以下へお願いします：

- GitHub Issues: https://github.com/your-org/taisun_agent/issues
- Discord: https://discord.gg/your-invite

---

## 📝 変更履歴

詳細は [CHANGELOG.md](./CHANGELOG.md) をご覧ください。

---

**TAISUN Agent チーム**
2026年1月15日
