# 要件定義書 / Requirements — Kindle Content Empire System
- Spec-Slug: kindle-content-empire
- Version: 0.1
- Status: Draft
- Last Updated: 2026-01-31

## 1. 目的 / Goal
- Kindle本の取得→オリジナル本生成→Amazon出品→note展開→YouTube動画化までを自動化し、コンテンツ収益を最大化するシステムを構築する。
- 成功指標: 月間10冊のKindle本出品、月間20本のnote記事公開、月間30本のYouTube動画公開を達成する。

## 2. 背景 / Context
- 現状、Kindle本の作成・note記事・YouTube動画の制作はすべて手動で行っており、1コンテンツあたり平均8時間を要している。
- 複数プラットフォームへのコンテンツ展開を自動化することで、制作時間を1コンテンツあたり30分以内に短縮したい。
- 購入済みKindle本の内容を参考に、著作権上問題のないオリジナルコンテンツを生成する必要がある。

## 3. スコープ
### 3.1 In Scope
- Kindle本のダウンロード・テキスト抽出（画像内OCR含む）
- 複数書籍の内容を組み合わせたオリジナル本の生成
- ePub形式への変換とAmazon KDP出品
- 表紙画像の自動生成
- Amazonキーワードリサーチ（売れ筋分析）
- note記事の生成（有料・無料）
- note売れ筋分析と構造解析
- YouTube台本生成（ショート・長編）
- NanoBanana Proによるナレーション生成
- Remotionによる動画レンダリング
- 海外バズ動画の構造分析

### 3.2 Out of Scope（重要）
- Amazon KDPアカウントの自動作成
- noteアカウントの自動作成
- YouTubeアカウントの自動作成
- 決済処理・売上管理
- 法的アドバイス・著作権判定の最終判断（システムはガイドラインを提示するが、最終判断はユーザー責任）
- 動画の自動アップロード（手動確認後にアップロード）

## 4. 用語集 / Glossary
| 用語 | 定義 |
|------|------|
| KDP | Kindle Direct Publishing。AmazonのKindle本出版サービス。 |
| ePub | 電子書籍の標準フォーマット。 |
| OCR | Optical Character Recognition。画像からテキストを抽出する技術。 |
| note | 日本国内のコンテンツプラットフォーム。有料・無料記事を公開可能。 |
| NanoBanana Pro | AI音声生成ツール。ナレーション生成に使用。 |
| Remotion | Reactベースの動画生成フレームワーク。 |
| ショート動画 | 60秒以内の縦型動画（YouTube Shorts形式）。 |
| 長編動画 | 3分以上の横型動画。 |
| バズ動画 | 100万回以上再生された動画。 |

## 5. ステークホルダー & 役割
| Role | 権限/責務 |
|------|----------|
| システム管理者 | システム設定、APIキー管理、スケジュール設定 |
| コンテンツオペレーター | コンテンツ生成の実行、品質確認、公開承認 |
| レビュアー | 生成コンテンツの著作権チェック、品質レビュー |

## 6. 前提/仮定（Assumptions）
- ユーザーはAmazon KDPアカウントを保有している。
- ユーザーはnoteアカウントを保有している。
- ユーザーはYouTubeチャンネルを保有している。
- Kindle本は購入済みであり、個人利用の範囲でテキスト抽出を行う。
- NanoBanana Pro APIが利用可能である。
- Remotion環境がローカルまたはクラウドで利用可能である。
- 生成コンテンツの著作権判断はユーザーが最終責任を負う。

## 7. 制約（Constraints）
### 7.1 技術制約
- Kindle DRMの解除は行わない（購入済み書籍の正規手段でのテキスト取得のみ）。
- 動画レンダリングは1080p以上の解像度をサポートする。
- システムはNode.js 18以上で動作する。

### 7.2 法務制約
- 著作権法を遵守し、オリジナルコンテンツのみを生成する。
- 生成コンテンツには出典を明示しない（オリジナルとして扱うため）。
- 個人情報は収集・保存しない。

### 7.3 運用制約
- API呼び出しは各サービスのレート制限に従う。
- 1日あたりの動画生成数は10本以内とする（リソース制約）。

## 8. 依存関係（Dependencies）
| 依存先 | 種別 | 影響 |
|--------|------|------|
| Amazon KDP API | 外部API | 出品機能に必須 |
| note API | 外部API | 記事投稿に必須（公式APIがない場合はブラウザ自動化） |
| YouTube Data API | 外部API | 動画分析に必須 |
| NanoBanana Pro API | 外部API | ナレーション生成に必須 |
| Remotion | ライブラリ | 動画レンダリングに必須 |
| Tesseract OCR | ライブラリ | 画像テキスト抽出に必須 |

## 9. 機能要件（Functional Requirements）

### REQ-001: Kindle本テキスト抽出
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがKindle本のASINを指定したとき、システムは当該書籍の全テキストを抽出し、Markdown形式で保存しなければならない。
- 根拠/目的: コンテンツ生成の原材料となるテキストデータを取得するため。
- 受入テスト(GWT):
  - AT-001: Given 有効なASIN「B0XXXXXXXX」が入力された When テキスト抽出を実行する Then 30秒以内にMarkdownファイルが生成され、文字数が1000文字以上である
- 例外・エラー:
  - EH-001: ASINが無効な場合、システムはエラーコード「INVALID_ASIN」を返し、処理を中止しなければならない。
  - EH-002: Kindle本が購入済みでない場合、システムはエラーコード「NOT_PURCHASED」を返し、処理を中止しなければならない。
- 補足:
  - DRM解除は行わない。Kindle Cloud Readerまたは正規手段を使用する。

### REQ-002: 画像内テキストOCR抽出
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): Kindle本内に画像が含まれているとき、システムはOCRを使用して画像内のテキストを抽出し、本文に統合しなければならない。
- 根拠/目的: 図表や画像内のテキスト情報も含めた完全なコンテンツ抽出のため。
- 受入テスト(GWT):
  - AT-002: Given 画像を含むKindle本がある When テキスト抽出を実行する Then 画像内のテキストが本文に統合され、OCR精度が95%以上である
- 例外・エラー:
  - EH-003: OCRが失敗した場合、システムは当該画像をスキップし、ログに「OCR_FAILED」を記録し、処理を継続しなければならない。
- 補足:
  - 日本語・英語の混在テキストに対応する。

### REQ-003: オリジナル本生成
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーが2冊以上のKindle本テキストと生成指示を入力したとき、システムは入力テキストを参考に著作権上問題のないオリジナル本を生成しなければならない。
- 根拠/目的: 複数の書籍を参考にしたオリジナルコンテンツを自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-003: Given 3冊のKindle本テキストと「投資入門書を作成」という指示がある When オリジナル本生成を実行する Then 10分以内に20000文字以上のオリジナル本が生成され、類似度チェックで元テキストとの一致率が20%未満である
- 例外・エラー:
  - EH-004: 入力テキストが1冊のみの場合、システムはエラーコード「SOURCE_COUNT_LOW」を返し、処理を中止しなければならない。
  - EH-005: 生成テキストの類似度が20%以上の場合、システムは警告「HIGH_SIMILARITY」を表示し、再生成を提案しなければならない。
- 補足:
  - 類似度チェックにはコサイン類似度を使用する。

### REQ-004: ePub変換
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): オリジナル本が生成されたとき、システムは当該テキストをePub形式に変換し、目次・章構成を自動生成しなければならない。
- 根拠/目的: Amazon KDPへの出品に必要なフォーマットを生成するため。
- 受入テスト(GWT):
  - AT-004: Given 20000文字のオリジナル本テキストがある When ePub変換を実行する Then 60秒以内にePubファイルが生成され、epubcheckでエラーが0件である
- 例外・エラー:
  - EH-006: 変換に失敗した場合、システムはエラーコード「EPUB_CONVERSION_FAILED」を返し、エラー詳細をログに記録しなければならない。
- 補足:
  - ePub 3.0形式を使用する。

### REQ-005: 表紙画像自動生成
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ePub変換時にユーザーがタイトルとサブタイトルを指定したとき、システムは1600x2560ピクセルの表紙画像を自動生成しなければならない。
- 根拠/目的: Amazon KDPの表紙要件を満たす画像を自動生成するため。
- 受入テスト(GWT):
  - AT-005: Given タイトル「投資の極意」とサブタイトル「初心者向け完全ガイド」がある When 表紙生成を実行する Then 30秒以内に1600x2560ピクセルのPNG画像が生成される
- 例外・エラー:
  - EH-007: 画像生成に失敗した場合、システムはデフォルトテンプレートを使用し、警告「COVER_FALLBACK」をログに記録しなければならない。
- 補足:
  - 複数のテンプレートから選択可能とする。

### REQ-006: Amazon KDP出品準備
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ePubと表紙画像が生成されたとき、システムはAmazon KDP出品に必要なメタデータ（タイトル、説明文、カテゴリ、キーワード）を生成し、出品パッケージとして保存しなければならない。
- 根拠/目的: KDP出品作業を効率化するため。
- 受入テスト(GWT):
  - AT-006: Given ePubと表紙画像がある When 出品準備を実行する Then メタデータJSON、ePub、表紙画像を含むZIPファイルが生成される
- 例外・エラー:
  - EH-008: 必須メタデータが不足している場合、システムはエラーコード「MISSING_METADATA」を返し、不足項目を一覧表示しなければならない。
- 補足:
  - 自動出品は行わない（手動確認後にアップロード）。

### REQ-007: Amazonキーワードリサーチ
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがカテゴリを指定したとき、システムはAmazonの当該カテゴリにおける売れ筋キーワードを100件以上抽出し、検索ボリューム推定値とともに表示しなければならない。
- 根拠/目的: 売れる本のテーマ選定を支援するため。
- 受入テスト(GWT):
  - AT-007: Given カテゴリ「ビジネス・経済」が指定された When キーワードリサーチを実行する Then 60秒以内に100件以上のキーワードが検索ボリューム順にソートされて表示される
- 例外・エラー:
  - EH-009: Amazonへのアクセスが失敗した場合、システムは3回までリトライし、それでも失敗した場合はエラーコード「AMAZON_ACCESS_FAILED」を返さなければならない。
- 補足:
  - リサーチ結果はCSVエクスポート可能とする。

### REQ-008: note売れ筋分析
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがnoteのカテゴリまたはキーワードを指定したとき、システムは売れている有料note記事を50件以上取得し構造分析結果を出力しなければならない。
- 根拠/目的: 売れるnote記事の構造パターンを把握するため。
- 受入テスト(GWT):
  - AT-008: Given キーワード「副業」が指定された When 売れ筋分析を実行する Then 120秒以内に50件以上の記事分析結果が表示され、各記事の見出し構成・文字数・価格が含まれる
- 例外・エラー:
  - EH-010: noteへのアクセスが失敗した場合、システムは3回までリトライし、それでも失敗した場合はエラーコード「NOTE_ACCESS_FAILED」を返さなければならない。
- 補足:
  - ブラウザ自動化（Playwright）を使用する。

### REQ-009: note記事生成（有料）
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがオリジナル本テキストと価格（300円/500円/1000円のいずれか）を指定したとき、システムは売れ筋分析結果に基づいた構造で有料note記事を生成しなければならない。
- 根拠/目的: 売れる構造に沿った有料note記事を自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-009: Given オリジナル本テキストと価格「500円」が指定された When 有料note生成を実行する Then 5分以内に3000文字以上の記事が生成され、見出しが5つ以上含まれる
- 例外・エラー:
  - EH-011: 指定価格が300円/500円/1000円以外の場合、システムはエラーコード「INVALID_PRICE」を返さなければならない。
- 補足:
  - プレビュー用の無料部分（500文字）を自動設定する。

### REQ-010: note記事生成（無料）
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがオリジナル本テキストを指定したとき、システムは集客用無料note記事を生成しなければならない。
- 根拠/目的: 有料記事への集客を目的とした無料記事を自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-010: Given オリジナル本テキストがある When 無料note生成を実行する Then 3分以内に1500文字以上の記事が生成され、有料記事へのリンクプレースホルダーが含まれる
- 例外・エラー:
  - EH-012: テキストが不足している場合、システムはエラーコード「TEXT_LENGTH_LOW」を返さなければならない。
- 補足:
  - CTA（Call to Action）を自動挿入する。

### REQ-011: YouTube台本生成（ショート動画）
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがオリジナル本テキストを指定したとき、システムは60秒以内で読み上げ可能なショート動画用台本を生成しなければならない。
- 根拠/目的: YouTube Shorts向けの短尺コンテンツを自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-011: Given オリジナル本テキストがある When ショート台本生成を実行する Then 60秒以内に150文字以上300文字以下の台本が生成される
- 例外・エラー:
  - EH-013: 生成台本が300文字を超える場合、システムは自動的に要約し、警告「SCRIPT_TRUNCATED」をログに記録しなければならない。
- 補足:
  - フック（冒頭3秒）を強調した構成とする。

### REQ-012: YouTube台本生成（長編動画）
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ユーザーがオリジナル本テキストと目標再生時間（3分/5分/10分のいずれか）を指定したとき、システムは当該時間に適した長編動画用台本を生成しなければならない。
- 根拠/目的: 収益化可能な長尺コンテンツを自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-012: Given オリジナル本テキストと目標時間「5分」が指定された When 長編台本生成を実行する Then 3分以内に1200文字以上1500文字以下の台本が生成される
- 例外・エラー:
  - EH-014: 目標時間が3分/5分/10分以外の場合、システムはエラーコード「INVALID_DURATION」を返さなければならない。
- 補足:
  - 章立て構成（イントロ→本編→まとめ→CTA）を自動生成する。

### REQ-013: 海外バズ動画構造分析
- 種別: EARS-イベント駆動
- 優先度: SHOULD
- 要件文(EARS): ユーザーがYouTube動画URLを指定したとき、システムは当該動画の構造（タイムスタンプ、セクション、フック、CTA位置）を分析し、テンプレートとして保存しなければならない。
- 根拠/目的: バズ動画の成功パターンを学習し、台本生成に活用するため。
- 受入テスト(GWT):
  - AT-013: Given バズ動画URL「https://youtube.com/watch?v=xxx」が指定された When 構造分析を実行する Then 60秒以内に動画構造JSONが生成され、セクション数が3つ以上抽出される
- 例外・エラー:
  - EH-015: 動画にアクセスできない場合、システムはエラーコード「VIDEO_ACCESS_FAILED」を返さなければならない。
- 補足:
  - 字幕データがある場合は字幕も抽出する。

### REQ-014: NanoBanana Proナレーション生成
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): YouTube台本が生成されたとき、システムはNanoBanana Pro APIを使用してナレーション音声を生成しなければならない。
- 根拠/目的: 動画制作に必要な音声素材を自動生成するため。
- 受入テスト(GWT):
  - AT-014: Given 300文字のショート台本がある When ナレーション生成を実行する Then 120秒以内にMP3ファイルが生成され、再生時間が50秒以上70秒以下である
- 例外・エラー:
  - EH-016: NanoBanana Pro APIが失敗した場合、システムは3回までリトライし、それでも失敗した場合はエラーコード「NARRATION_FAILED」を返さなければならない。
- 補足:
  - 音声スピードは1.0倍〜1.2倍で調整可能とする。

### REQ-015: Remotion動画レンダリング
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): ナレーション音声とテキストが準備されたとき、システムはRemotionを使用して動画をレンダリングしなければならない。
- 根拠/目的: 最終的な動画ファイルを自動生成するため。
- 受入テスト(GWT):
  - AT-015: Given ナレーション音声と台本がある When 動画レンダリングを実行する Then 5分以内に1080p解像度のMP4ファイルが生成される
- 例外・エラー:
  - EH-017: レンダリングが失敗した場合、システムはエラーコード「RENDER_FAILED」を返し、エラー詳細をログに記録しなければならない。
- 補足:
  - ショート動画は9:16、長編動画は16:9のアスペクト比とする。

### REQ-016: 動画テンプレート管理
- 種別: EARS-普遍
- 優先度: SHOULD
- 要件文(EARS): システムは動画テンプレートを10種類以上保持しなければならない。
- 根拠/目的: 多様なスタイルの動画を自動化により時間短縮に生成するため。
- 受入テスト(GWT):
  - AT-016: Given システムが起動している When テンプレート一覧を表示する Then 10種類以上のテンプレートが表示される
- 例外・エラー:
  - EH-018: テンプレートが読み込めない場合、システムはデフォルトテンプレートを使用し、警告「TEMPLATE_FALLBACK」をログに記録しなければならない。
- 補足:
  - カスタムテンプレートの追加機能は将来実装予定。

## 10. 非機能要件（Non-Functional Requirements）

### REQ-900: 処理速度
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムは1冊のKindle本から動画完成までの全工程を30分以内に完了しなければならない。
- 根拠/目的: 自動化により時間短縮なコンテンツ量産を実現するため。
- 受入テスト(GWT):
  - AT-900: Given 50000文字のKindle本がある When 全自動パイプラインを実行する Then 30分以内に動画ファイルが生成される
- 例外・エラー:
  - EH-900: 30分を超過した場合、システムは警告「TIMEOUT_WARNING」を表示し、処理を継続しなければならない。
- 補足:
  - 並列処理により処理時間短縮を図る。

### REQ-901: 可用性
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムは月間稼働率99%以上を維持しなければならない。
- 根拠/目的: 安定したコンテンツ生産を保証するため。
- 受入テスト(GWT):
  - AT-901: Given 1ヶ月の運用期間がある When 稼働率を計算する Then 稼働率が99%以上である
- 例外・エラー:
  - EH-901: 稼働率が99%を下回った場合、システムはアラートを管理者に送信しなければならない。
- 補足:
  - ダウンタイムは月間7.2時間以内。

### REQ-902: データ保持
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムは生成したコンテンツ（テキスト、画像、動画）を90日間保持しなければならない。
- 根拠/目的: 再編集・再利用を可能にするため。
- 受入テスト(GWT):
  - AT-902: Given 89日前に生成したコンテンツがある When コンテンツを取得する Then コンテンツが正常に取得できる
- 例外・エラー:
  - EH-902: 90日を超過したコンテンツは自動削除し、ログに「CONTENT_EXPIRED」を記録しなければならない。
- 補足:
  - 削除前に警告メールを送信する。

### REQ-903: 同時実行制御
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムは最大5つのコンテンツ生成ジョブを同時実行しなければならない。
- 根拠/目的: リソースを自動化により時間短縮に活用しつつ、安定性を維持するため。
- 受入テスト(GWT):
  - AT-903: Given 5つのジョブが実行中である When 6つ目のジョブを投入する Then 6つ目のジョブはキューに入り、待機状態となる
- 例外・エラー:
  - EH-903: キューが100件を超えた場合、システムはエラーコード「QUEUE_FULL」を返し、新規ジョブを拒否しなければならない。
- 補足:
  - ジョブ優先度設定は将来実装予定。

## 11. セキュリティ/プライバシー要件

### REQ-950: APIキー管理
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムはすべてのAPIキーを環境変数または暗号化されたシークレットストアに保存しなければならない。
- 根拠/目的: APIキーの漏洩を防止するため。
- 受入テスト(GWT):
  - AT-950: Given システムが起動している When ソースコードを検索する Then APIキーがハードコードされていない
- 例外・エラー:
  - EH-950: APIキーがハードコードされている場合、CIでビルドを失敗させなければならない。
- 補足:
  - .envファイルは.gitignoreに含める。

### REQ-951: ログマスキング
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムはログ出力時にAPIキー、認証トークン、個人識別情報をマスキングしなければならない。
- 根拠/目的: ログからの情報漏洩を防止するため。
- 受入テスト(GWT):
  - AT-951: Given APIキーを含むリクエストがある When ログを出力する Then APIキーが「***」でマスキングされている
- 例外・エラー:
  - EH-951: マスキング漏れを検出した場合、システムはアラートを送信しなければならない。
- 補足:
  - 正規表現パターンでマスキング対象を定義する。

## 12. ログ/監視/運用要件

### REQ-960: 構造化ログ
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムはすべての処理ログをJSON形式で出力しなければならない。
- 根拠/目的: ログ分析・監視を効率化するため。
- 受入テスト(GWT):
  - AT-960: Given 処理が実行された When ログを確認する Then ログがJSON形式であり、timestamp、level、messageフィールドを含む
- 例外・エラー:
  - EH-960: ログ出力に失敗した場合、システムは標準エラー出力にフォールバックしなければならない。
- 補足:
  - ログレベルはDEBUG/INFO/WARN/ERRORの4段階。

### REQ-961: ジョブ進捗監視
- 種別: EARS-普遍
- 優先度: MUST
- 要件文(EARS): システムは各ジョブの進捗状況（開始、処理中、完了、失敗）をリアルタイムで表示しなければならない。
- 根拠/目的: オペレーターがジョブ状況を把握するため。
- 受入テスト(GWT):
  - AT-961: Given ジョブが実行中である When ダッシュボードを表示する Then ジョブの進捗率（0-100%）がリアルタイムで更新される
- 例外・エラー:
  - EH-961: 進捗更新が60秒以上停止した場合、システムは警告「PROGRESS_STALLED」を表示しなければならない。
- 補足:
  - WebSocket経由でリアルタイム更新する。

### REQ-962: エラーアラート
- 種別: EARS-イベント駆動
- 優先度: MUST
- 要件文(EARS): エラーが発生したとき、システムは5分以内に管理者にSlack通知を送信しなければならない。
- 根拠/目的: 障害の早期発見・対応を可能にするため。
- 受入テスト(GWT):
  - AT-962: Given エラーが発生した When 5分経過する Then Slackにエラー通知が届いている
- 例外・エラー:
  - EH-962: Slack通知に失敗した場合、システムはメール通知にフォールバックしなければならない。
- 補足:
  - 通知先はSlackチャンネル「#alerts」。

## 13. 未解決事項（Open Questions）
（なし - すべての要件が明確化されています）
